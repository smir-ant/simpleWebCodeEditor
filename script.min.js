document.addEventListener("DOMContentLoaded",()=>{const p=document.getElementById("textarea");const e=document.getElementById("container");const n=document.createElement("pre");n.classList.add("mirror");e.appendChild(n);const t=()=>{const t=window.getComputedStyle(p);["border","fontFamily","fontSize","fontWeight","lineHeight","padding","whiteSpace"].forEach(e=>n.style[e]=t[e]);n.style.borderColor="transparent"};const u=()=>{n.innerHTML=Prism.highlight(p.value+"\n",Prism.languages.sql,"sql");n.scrollTop=p.scrollTop};const h=e=>{document.execCommand("insertText",false,e)};const l=()=>{const e=p.selectionStart;const t=p.selectionEnd;const n=p.value;const s=n.substring(0,e);console.log("beforeCursor:",s);const o=n.substring(t);const c=s.lastIndexOf("\n")+1;const l=o.indexOf("\n")!==-1?t+o.indexOf("\n"):n.length;const i=n.substring(c,l).split("\n");const r=i.every(e=>e.trim().startsWith("--"));let a="";let d=0;if(r){a=i.map(e=>e.replace(/^--\s?/,"")).join("\n");d=-3}else{a=i.map(e=>`-- ${e}`).join("\n");d=3}const g=i.length;p.setSelectionRange(c,l);h(a);const f=e+d;const m=t+d*g;p.setSelectionRange(f,m);u()};p.addEventListener("keydown",e=>{if((e.ctrlKey||e.metaKey)&&e.key==="/"){e.preventDefault();l()}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault();const t=p.selectionStart;const n=p.selectionEnd;h("    ");p.setSelectionRange(t+4,t+4)}if(e.key==="Tab"&&e.shiftKey){e.preventDefault();const t=p.selectionStart;const s=p.value;const o=s.lastIndexOf("\n",t-1)+1;const c=s.substring(o,t);if(c.endsWith("    ")){p.setSelectionRange(o+c.length-4,t);h("");p.setSelectionRange(t-4,t-4)}}});p.addEventListener("input",u);p.addEventListener("scroll",()=>n.scrollTop=p.scrollTop);t();u()});